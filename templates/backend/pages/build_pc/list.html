{% extends 'backend/components/layout.html' %}

{% block content %}
<div class="container-fluid px-4">
    <h1 class="mt-4">Quản lý nhóm lựa chọn PC</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
        <li class="breadcrumb-item active">Nhóm lựa chọn PC</li>
    </ol>
    
    <!-- Info Section -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-info-circle me-1"></i>
            Thông tin
        </div>
        <div class="card-body">
            <p class="mb-0">
                <i class="fas fa-list text-primary"></i>
                Quản lý nhóm lựa chọn PC cho phép bạn tạo các nhóm linh kiện như CPU, RAM, VGA, SSD, v.v.
                Mỗi nhóm có thể chứa nhiều linh kiện để khách hàng lựa chọn khi build PC.
            </p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <i class="fas fa-list me-1"></i>
                    Danh sách nhóm lựa chọn PC
                </div>
                <div>
                    <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addGroupModal">
                        <i class="fas fa-plus"></i> Thêm nhóm lựa chọn
                    </button>
                    <button type="button" class="btn btn-info me-2" data-bs-toggle="modal" data-bs-target="#listGroupsModal">
                        <i class="fas fa-eye"></i> Xem danh sách
                    </button>
                    <a href="{{ url_for('products.list_products') }}" class="btn btn-secondary">
                        <i class="fas fa-cube"></i> Quản lý linh kiện
                    </a>
                </div>
            </div>
        </div>
        <div class="card-body">
            <!-- Thông tin kết quả -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <p class="text-muted mb-0">
                        <i class="fas fa-info-circle"></i>
                        Hiển thị <strong>{{ option_groups|length }}</strong> nhóm lựa chọn PC
                    </p>
                </div>
            </div>
            
            {% if option_groups %}
            <div class="row">
                {% for group in option_groups %}
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-list text-primary me-2"></i>
                                {{ group.Name }}
                            </h5>
                            {% if group.Description %}
                            <p class="card-text text-muted">{{ group.Description }}</p>
                            {% endif %}
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-info">{{ group.items|length }} linh kiện</span>
                                <div>
                                    <button type="button" class="btn btn-sm btn-outline-success" data-bs-toggle="modal" 
                                            data-bs-target="#addItemModal{{ group.OptionGroupID }}">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" 
                                            data-bs-target="#editGroupModal{{ group.OptionGroupID }}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" 
                                            data-bs-target="#deleteGroupModal{{ group.OptionGroupID }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- Thông báo khi không có nhóm lựa chọn -->
            <div class="text-center py-5">
                <i class="fas fa-list fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">Chưa có nhóm lựa chọn nào</h5>
                <p class="text-muted">
                    Thêm nhóm lựa chọn mới để bắt đầu tạo các nhóm linh kiện cho PC.
                </p>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGroupModal">
                    <i class="fas fa-plus"></i> Thêm nhóm lựa chọn đầu tiên
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Modal thêm nhóm lựa chọn -->
<div class="modal fade" id="addGroupModal" tabindex="-1" aria-labelledby="addGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addGroupModalLabel">
                    <i class="fas fa-plus me-2"></i>Thêm nhóm lựa chọn mới
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{{ url_for('build_pc.add_option_group') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="name" class="form-label">Tên nhóm lựa chọn</label>
                        <input type="text" class="form-control" id="name" name="name" 
                               placeholder="Ví dụ: CPU, RAM, VGA, SSD, PSU..." required>
                        <div class="form-text">Nhập tên nhóm lựa chọn như CPU, RAM, VGA, v.v.</div>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Mô tả (tùy chọn)</label>
                        <textarea class="form-control" id="description" name="description" rows="3" 
                                  placeholder="Mô tả ngắn về nhóm lựa chọn này..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Thêm nhóm
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal xem danh sách nhóm lựa chọn -->
<div class="modal fade" id="listGroupsModal" tabindex="-1" aria-labelledby="listGroupsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="listGroupsModalLabel">
                    <i class="fas fa-list me-2"></i>Danh sách nhóm lựa chọn PC
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if option_groups %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tên nhóm</th>
                                <th>Mô tả</th>
                                <th>Số linh kiện</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for group in option_groups %}
                            <tr>
                                <td>{{ group.OptionGroupID }}</td>
                                <td>
                                    <strong>{{ group.Name }}</strong>
                                </td>
                                <td>{{ group.Description or 'Chưa có mô tả' }}</td>
                                <td>
                                    <span class="badge bg-info">{{ group.items|length }}</span>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" 
                                            data-bs-target="#editGroupModal{{ group.OptionGroupID }}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" 
                                            data-bs-target="#deleteGroupModal{{ group.OptionGroupID }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-list fa-2x text-muted mb-3"></i>
                    <p class="text-muted">Chưa có nhóm lựa chọn nào</p>
                </div>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal chỉnh sửa nhóm lựa chọn -->
{% for group in option_groups %}
<div class="modal fade" id="editGroupModal{{ group.OptionGroupID }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chỉnh sửa nhóm lựa chọn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{{ url_for('build_pc.edit_option_group', group_id=group.OptionGroupID) }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="name{{ group.OptionGroupID }}" class="form-label">Tên nhóm</label>
                        <input type="text" class="form-control" id="name{{ group.OptionGroupID }}" name="name" 
                               value="{{ group.Name }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="description{{ group.OptionGroupID }}" class="form-label">Mô tả</label>
                        <textarea class="form-control" id="description{{ group.OptionGroupID }}" name="description" rows="3">{{ group.Description or '' }}</textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal xóa nhóm lựa chọn -->
<div class="modal fade" id="deleteGroupModal{{ group.OptionGroupID }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa nhóm lựa chọn <strong>"{{ group.Name }}"</strong> không?</p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    Tất cả linh kiện trong nhóm này cũng sẽ bị xóa.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <form method="post" action="{{ url_for('build_pc.delete_option_group', group_id=group.OptionGroupID) }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger">Xóa</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Modal thêm linh kiện vào nhóm -->
{% for group in option_groups %}
<div class="modal fade" id="addItemModal{{ group.OptionGroupID }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm linh kiện vào nhóm "{{ group.Name }}"</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{{ url_for('build_pc.add_option_item', group_id=group.OptionGroupID) }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="component_id{{ group.OptionGroupID }}" class="form-label">Chọn linh kiện</label>
                        <select class="form-select" id="component_id{{ group.OptionGroupID }}" name="component_id" required>
                            <option value="">Chọn linh kiện...</option>
                            {% for component in components %}
                            <option value="{{ component.ProductID }}">
                                {{ component.Name }} - {{ "{:,.0f}".format(component.Price) }} VNĐ
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="is_default{{ group.OptionGroupID }}" 
                               name="is_default" value="1">
                        <label class="form-check-label" for="is_default{{ group.OptionGroupID }}">
                            Đặt làm lựa chọn mặc định
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-success">Thêm linh kiện</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{% endblock %} 